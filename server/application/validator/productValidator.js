const { body, query, param } = require('express-validator');
//const { ObjectId } = require('mongodb');
const { ObjectId } = require('mongoose').Types;

/**
 * Clase para validar los datos del producto.
 */
class ProductValidator {
    /**
     * Valida los datos del producto.
     * @returns {Array} - Un array de validaciones.
     */
    validateProductData = () => {
        return [
            body('nombre')
                .notEmpty().withMessage('El nombre es obligatorio') // ‚úîÔ∏è El nombre es obligatorio
                .isString().withMessage('El nombre debe ser un string'), // ‚úîÔ∏è Debe ser un string

            body('categoria')
                .notEmpty().withMessage('La categor√≠a es obligatoria') // ‚úîÔ∏è La categor√≠a es obligatoria
                .isString().withMessage('La categor√≠a debe ser un string'), // ‚úîÔ∏è Debe ser un string

            body('descripcion')
                .notEmpty().withMessage('La descripci√≥n es obligatoria') // ‚úîÔ∏è La descripci√≥n es obligatoria
                .isString().withMessage('La descripci√≥n debe ser un string'), // ‚úîÔ∏è Debe ser un string
    
            body('precio')
                .notEmpty().withMessage('El precio es obligatorio') // ‚úîÔ∏è El precio es obligatorio
                .isNumeric().withMessage('El precio debe ser un n√∫mero') // ‚úîÔ∏è Debe ser un n√∫mero
                .custom((value) => {
                    if (value <= 0) {
                        throw new Error('El precio debe ser un n√∫mero mayor que cero'); // ‚ùå El precio debe ser mayor que cero
                    }
                    return true; // ‚úîÔ∏è Es v√°lido
                }),
    
            body('dimensiones')
                .notEmpty().withMessage('Las dimensiones son obligatorias') // ‚úîÔ∏è Las dimensiones son obligatorias
                .isString().withMessage('Las dimensiones deben ser un string'), // ‚úîÔ∏è Debe ser un string
    
            body('foto')
                .notEmpty().withMessage('La foto es obligatoria') // ‚úîÔ∏è La foto es obligatoria
                .isURL().withMessage('La foto debe ser una URL v√°lida'), // ‚úîÔ∏è Debe ser una URL v√°lida
    
            body('stock')
                .notEmpty().withMessage('El stock es obligatorio') // ‚úîÔ∏è El stock es obligatorio
                .isInt().withMessage('El stock debe ser un n√∫mero entero'), // ‚úîÔ∏è Debe ser un n√∫mero entero

            body('dimensiones')
                .notEmpty().withMessage('Las dimensiones son obligatorias') // ‚úîÔ∏è Las dimensiones son obligatorias (Corregido)
                .isString().withMessage('Las dimensiones deben ser un string'), // ‚úîÔ∏è Debe ser un string

            body('foto')
                .notEmpty().withMessage('La foto es obligatoria') // ‚úîÔ∏è La foto es obligatoria (Corregido)
                .isString().withMessage('La foto debe ser un string'), // ‚úîÔ∏è Debe ser un string

            body('descuento')
                .optional() // üü° Es opcional
                .custom(value => {
                    // Permitir que el valor sea un n√∫mero o una cadena
                    if (typeof value === 'number' || typeof value === 'string') {
                        return true; // ‚úîÔ∏è Es v√°lido
                    }
                    throw new Error('El descuento debe ser un n√∫mero o una cadena si se proporciona'); // ‚ùå Debe ser un n√∫mero o cadena
                }),

            body('artesanoId')
                .notEmpty().withMessage('El artesanoId es obligatorio') // ‚úîÔ∏è El artesanoId es obligatorio
                .custom((value) => {
                    if (!ObjectId.isValid(value)) {
                        throw new Error('El artesanoId debe ser un ObjectId v√°lido'); // ‚ùå Debe ser un ObjectId v√°lido
                    }
                    return true; // ‚úîÔ∏è Es v√°lido
                }),
        ];
    };

    /**
     * Valida la categor√≠a del producto.
     * @returns {Array} - Un array de validaciones.
     */
    validateProductCategory = () => {
        return [
            body('categoria').notEmpty().isString().withMessage('Envia la categoria'), // ‚úîÔ∏è La categor√≠a es obligatoria
            query().custom((value, { req }) => {
                if (Object.keys(req.query).length > 0) {
                    throw new Error(`Don't send anything in the url`); // ‚ùå No env√≠es nada en la URL
                }
                return true; // ‚úîÔ∏è Es v√°lido
            })
        ];
    };

    /**
     * Valida que no se env√≠en datos del producto.
     * @returns {Array} - Un array de validaciones.
     */
    validateProductDataEmpty = () => {
        return [
            body().custom((value, { req }) => {
                if (Object.keys(req.body).length > 0) {
                    throw new Error('Do not send anything in the body'); // ‚ùå No env√≠es nada en el cuerpo
                }
                return true; // ‚úîÔ∏è Es v√°lido
            }),
            query().custom((value, { req }) => {
                if (Object.keys(req.query).length > 0) {
                    throw new Error(`Don't send anything in the url`); // ‚ùå No env√≠es nada en la URL
                }
                return true; // ‚úîÔ∏è Es v√°lido
            })
        ];
    };

    /**
     * Valida los datos de actualizaci√≥n del producto por ID.
     * @returns {Array} - Un array de validaciones.
     */
    validateProductUpdateDataByID = () => {
        return [
            param('id').custom((value) => {
                if (!ObjectId.isValid(value)) {
                    throw new Error('El ID debe ser un ObjectId v√°lido'); // ‚ùå El ID debe ser un ObjectId v√°lido
                }
                return true; // ‚úîÔ∏è Es v√°lido
            }),
    
            body('nombre')
            .notEmpty().withMessage('El nombre es obligatorio') // ‚úîÔ∏è El nombre es obligatorio
            .isString().withMessage('El nombre debe ser un string'), // ‚úîÔ∏è Debe ser un string

        body('categoria')
            .notEmpty().withMessage('La categor√≠a es obligatoria') // ‚úîÔ∏è La categor√≠a es obligatoria
            .isString().withMessage('La categor√≠a debe ser un string'), // ‚úîÔ∏è Debe ser un string

        body('descripcion')
            .notEmpty().withMessage('La descripci√≥n es obligatoria') // ‚úîÔ∏è La descripci√≥n es obligatoria
            .isString().withMessage('La descripci√≥n debe ser un string'), // ‚úîÔ∏è Debe ser un string

        body('precio')
            .notEmpty().withMessage('El precio es obligatorio') // ‚úîÔ∏è El precio es obligatorio
            .isInt().withMessage('El stock debe ser un n√∫mero entero'), // ‚úîÔ∏è Debe ser un n√∫mero entero

        body('stock')
            .notEmpty().withMessage('El stock es obligatorio') // ‚úîÔ∏è El stock es obligatorio
            .isInt().withMessage('El stock debe ser un n√∫mero entero'), // ‚úîÔ∏è Debe ser un n√∫mero entero

        body('dimensiones')
            .notEmpty().withMessage('Las dimensiones son obligatorias') // ‚úîÔ∏è Las dimensiones son obligatorias (Corregido)
            .isString().withMessage('Las dimensiones deben ser un string'), // ‚úîÔ∏è Debe ser un string

        body('foto')
            .notEmpty().withMessage('La foto es obligatoria') // ‚úîÔ∏è La foto es obligatoria (Corregido)
            .isString().withMessage('La foto debe ser un string'), // ‚úîÔ∏è Debe ser un string

        body('descuento')
            .optional() // üü° Es opcional
            .custom(value => {
                // Permitir que el valor sea un n√∫mero o una cadena
                if (typeof value === 'number' || typeof value === 'string') {
                    return true; // ‚úîÔ∏è Es v√°lido
                }
                throw new Error('El descuento debe ser un n√∫mero o una cadena si se proporciona'); // ‚ùå Debe ser un n√∫mero o cadena
            }),

        body('artesanoId')
            .notEmpty().withMessage('El artesanoId es obligatorio') // ‚úîÔ∏è El artesanoId es obligatorio
            .custom((value) => {
                if (!ObjectId.isValid(value)) {
                    throw new Error('El artesanoId debe ser un ObjectId v√°lido'); // ‚ùå Debe ser un ObjectId v√°lido
                }
                return true; // ‚úîÔ∏è Es v√°lido
            }),
        ];
    };

    /**
     * Valida el ID del producto.
     * @returns {Array} - Un array de validaciones.
     */
    validateProductId = () => {
        return [
            param('id').custom((value, { req }) => {
                if (!ObjectId.isValid(value)) {
                    throw new Error('Submit a valid ID'); // ‚ùå Debe enviar un ID v√°lido
                }
                return true; // ‚úîÔ∏è Es v√°lido
            }),
            query().custom((value, { req }) => {
                if (Object.keys(req.query).length > 0) {
                    throw new Error(`Don't send anything in the url`); // ‚ùå No env√≠es nada en la URL
                }
                return true; // ‚úîÔ∏è Es v√°lido
            }),
            body().custom((value, { req }) => {
                if (Object.keys(req.body).length > 0) {
                    throw new Error('Do not send anything in the body'); // ‚ùå No env√≠es nada en el cuerpo
                }
                return true; // ‚úîÔ∏è Es v√°lido
            })
        ];
    };
    /**
 * Valida el ID del artesano y el t√©rmino de b√∫squeda para productos agrupados.
 * @returns {Array} - Un array de validaciones.
 */
validateProductGroupedIdValidator = () => {
    return [
        param('artesanoId').custom((value) => {
            // Verifica si el ID del artesano es un ObjectId v√°lido
            if (!ObjectId.isValid(value)) {
                throw new Error('Submit a valid artesano ID'); // ‚ùå Debe enviar un ID de artesano v√°lido
            }
            return true; // ‚úîÔ∏è Es v√°lido
        }),
        param('searchTerm').custom((value) => {
            // Verifica si el t√©rmino de b√∫squeda es una cadena no vac√≠a
            if (typeof value !== 'string' || value.trim() === '') {
                throw new Error('Submit a valid search term'); // ‚ùå Debe enviar un t√©rmino de b√∫squeda v√°lido
            }
            return true; // ‚úîÔ∏è Es v√°lido
        }),
        query().custom((value, { req }) => {
            // Verifica que no se env√≠en datos en la URL
            if (Object.keys(req.query).length > 0) {
                throw new Error(`Don't send anything in the URL`); // ‚ùå No env√≠es nada en la URL
            }
            return true; // ‚úîÔ∏è Es v√°lido
        }),
        body().custom((value, { req }) => {
            // Verifica que no se env√≠en datos en el cuerpo de la solicitud
            if (Object.keys(req.body).length > 0) {
                throw new Error('Do not send anything in the body'); // ‚ùå No env√≠es nada en el cuerpo
            }
            return true; // ‚úîÔ∏è Es v√°lido
        })
    ];
};

/**
 * Valida el ID del artesano y el t√©rmino de b√∫squeda opcional para encontrar productos agrupados por nombre.
 * @returns {Array} - Un array de validaciones.
 */
validateProductGroupedIdToFindByNameValidator = () => {
    return [
        param('artesanoId').custom((value) => {
            // Verifica si el ID del artesano es un ObjectId v√°lido
            if (!ObjectId.isValid(value)) {
                throw new Error('Submit a valid artesano ID'); // ‚ùå Debe enviar un ID de artesano v√°lido
            }
            return true; // ‚úîÔ∏è Es v√°lido
        }),
        query('searchTerm').optional().isString().withMessage('Submit a valid search term'), // üü° El t√©rmino de b√∫squeda es opcional y debe ser una cadena
    ];
};

}

module.exports = new ProductValidator();
